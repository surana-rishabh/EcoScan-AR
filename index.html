<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EcoScan AR - Smart Recycling Guide</title>
    <meta name="description"
        content="AI-powered recycling assistant with barcode scanning, GPS location, and community challenges.">
    <meta name="theme-color" content="#1a1a2e">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Camera Feed -->
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <!-- Live Detection Indicator -->
    <div id="live-indicator">
        <span class="pulse"></span>
        <span id="live-text">LIVE</span>
    </div>

    <!-- Language Selector -->
    <button id="lang-btn" class="icon-btn" onclick="toggleLanguageModal()">ğŸŒ</button>

    <!-- Header Stats -->
    <div id="stats">
        <div class="stat-item" onclick="showLeaderboard()">
            <span class="stat-icon">ğŸ†</span>
            <div class="stat-content">
                <span class="stat-value" id="points-count">0</span>
                <span class="stat-label" data-i18n="points">Points</span>
            </div>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-item">
            <span class="stat-icon">ğŸ“Š</span>
            <div class="stat-content">
                <span class="stat-value" id="items-count">0</span>
                <span class="stat-label" data-i18n="scanned">Scanned</span>
            </div>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-item">
            <span class="stat-icon">ğŸŒ</span>
            <div class="stat-content">
                <span class="stat-value"><span id="co2-count">0</span>kg</span>
                <span class="stat-label">COâ‚‚</span>
            </div>
        </div>
    </div>

    <!-- Location Badge -->
    <div id="location-badge" onclick="showLocationSettings()">
        <span>ğŸ“</span>
        <span id="location-name">Detecting GPS...</span>
    </div>

    <!-- Mode Toggle Buttons -->
    <div id="mode-toggle">
        <button class="mode-btn active" id="camera-mode-btn" onclick="switchMode('camera')">
            <span>ğŸ“·</span>
            <span data-i18n="camera">Camera</span>
        </button>
        <button class="mode-btn" id="barcode-mode-btn" onclick="switchMode('barcode')">
            <span>ğŸ“Š</span>
            <span data-i18n="barcode">Barcode</span>
        </button>
    </div>

    <!-- Barcode Scanner Overlay -->
    <div id="barcode-overlay" class="hidden">
        <div class="barcode-frame">
            <div class="barcode-corner tl"></div>
            <div class="barcode-corner tr"></div>
            <div class="barcode-corner bl"></div>
            <div class="barcode-corner br"></div>
            <div class="barcode-line"></div>
        </div>
        <p class="barcode-hint" data-i18n="barcode_hint">Point at barcode or QR code</p>
    </div>

    <!-- Scan Button -->
    <button id="scan-btn">
        <span id="scan-icon">â™»ï¸</span>
        <span id="scan-text" data-i18n="get_details">GET DETAILS</span>
    </button>

    <!-- Bottom Nav -->
    <nav id="bottom-nav">
        <button class="nav-btn active" onclick="showHome()">
            <span>ğŸ </span>
            <span data-i18n="home">Home</span>
        </button>
        <button class="nav-btn" onclick="showChallenges()">
            <span>ğŸ¯</span>
            <span data-i18n="challenges">Challenges</span>
        </button>
        <button class="nav-btn" onclick="showLeaderboard()">
            <span>ğŸ†</span>
            <span data-i18n="leaderboard">Leaderboard</span>
        </button>
        <button class="nav-btn" onclick="showNearby()">
            <span>ğŸ“</span>
            <span data-i18n="nearby">Nearby</span>
        </button>
    </nav>

    <!-- Result Card -->
    <div id="result" class="hidden">
        <div class="result-handle"></div>
        <div id="object-list-section"></div>
        <div id="result-header">
            <span id="result-icon">â™»ï¸</span>
            <h2 id="result-title">Unknown Item</h2>
        </div>
        <div id="result-category"></div>

        <!-- Location-specific rules -->
        <div id="location-rules" class="location-rules">
            <div class="location-header">
                <span>ğŸ“</span>
                <span id="location-rules-title">Local Rules</span>
            </div>
            <p id="location-rules-text"></p>
        </div>

        <div id="result-content">
            <div class="info-row">
                <span class="info-icon">ğŸ“¦</span>
                <div class="info-content">
                    <span class="info-label" data-i18n="disposal">Disposal</span>
                    <span id="disposal-text" class="info-value"></span>
                </div>
            </div>
            <div class="info-row">
                <span class="info-icon">ğŸ—‘ï¸</span>
                <div class="info-content">
                    <span class="info-label" data-i18n="bin">Bin</span>
                    <span id="bin-text" class="info-value"></span>
                </div>
            </div>
            <div class="info-row">
                <span class="info-icon">ğŸ’¡</span>
                <div class="info-content">
                    <span class="info-label" data-i18n="tip">Pro Tip</span>
                    <span id="tip-text" class="info-value"></span>
                </div>
            </div>
            <div id="crafts-section" class="crafts-section"></div>
        </div>

        <!-- Points earned -->
        <div id="points-earned" class="points-earned hidden">
            <span>ğŸ‰</span>
            <span id="points-earned-text">+10 Points!</span>
        </div>

        <button id="search-btn" class="search-button">
            <span>ğŸ”</span>
            <span data-i18n="find_ideas">Find Reuse Ideas Online</span>
        </button>

        <button id="close-btn" class="close-button" data-i18n="close">Close</button>
    </div>

    <!-- Challenges Modal -->
    <div id="challenges-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 data-i18n="challenges_title">ğŸ¯ Daily Challenges</h3>
                <button class="close-modal" onclick="closeChallenges()">Ã—</button>
            </div>
            <div class="challenges-container" id="challenges-list">
                <!-- Loaded from Firebase -->
                <div class="loading-spinner-small">Loading challenges...</div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 data-i18n="leaderboard_title">ğŸ† Community Leaderboard</h3>
                <button class="close-modal" onclick="closeLeaderboard()">Ã—</button>
            </div>
            <div class="leaderboard-tabs">
                <button class="lb-tab active" onclick="switchLeaderboard('weekly')">This Week</button>
                <button class="lb-tab" onclick="switchLeaderboard('monthly')">This Month</button>
                <button class="lb-tab" onclick="switchLeaderboard('alltime')">All Time</button>
            </div>
            <div class="leaderboard-container" id="leaderboard-list">
                <!-- Loaded from Firebase -->
                <div class="loading-spinner-small">Loading leaderboard...</div>
            </div>
        </div>
    </div>

    <!-- Nearby Facilities Modal -->
    <div id="nearby-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 data-i18n="nearby_title">ğŸ“ Nearby Recycling Centers</h3>
                <button class="close-modal" onclick="closeNearby()">Ã—</button>
            </div>
            <div class="nearby-container" id="nearby-list">
                <!-- Loaded from OpenStreetMap -->
                <div class="loading-spinner-small">Finding nearby facilities...</div>
            </div>
        </div>
    </div>

    <!-- Language Modal -->
    <div id="language-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸŒ Select Language</h3>
                <button class="close-modal" onclick="closeLanguageModal()">Ã—</button>
            </div>
            <div class="language-list">
                <button class="lang-option active" onclick="setLanguage('en')">ğŸ‡ºğŸ‡¸ English</button>
                <button class="lang-option" onclick="setLanguage('hi')">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤‚à¤¦à¥€ (Hindi)</button>
                <button class="lang-option" onclick="setLanguage('es')">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
                <button class="lang-option" onclick="setLanguage('fr')">ğŸ‡«ğŸ‡· FranÃ§ais</button>
                <button class="lang-option" onclick="setLanguage('de')">ğŸ‡©ğŸ‡ª Deutsch</button>
                <button class="lang-option" onclick="setLanguage('zh')">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</button>
                <button class="lang-option" onclick="setLanguage('ja')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
                <button class="lang-option" onclick="setLanguage('ar')">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="hidden">
        <div class="loading-content">
            <div class="logo-animation">
                <span class="logo-emoji">â™»ï¸</span>
            </div>
            <h2>EcoScan AR</h2>
            <p id="loading-status">Loading AI Model...</p>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div id="search-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="search-modal-title">Searching...</h3>
                <button id="close-modal" class="close-modal">Ã—</button>
            </div>
            <div id="search-results" class="search-results"></div>
        </div>
    </div>

    <!-- Instructions -->
    <div id="instructions" class="instructions hidden">
        <div class="instruction-card">
            <div class="instruction-icon">ğŸŒ±</div>
            <h3 data-i18n="welcome">Welcome to EcoScan AR!</h3>
            <p data-i18n="welcome_desc">Scan any item to learn how to recycle it properly.</p>
            <div class="feature-list">
                <div class="feature">ğŸ“· AI Object Detection</div>
                <div class="feature">ğŸ“Š Real Barcode Database</div>
                <div class="feature">ğŸ“ GPS Location</div>
                <div class="feature">ğŸ¯ Live Challenges</div>
                <div class="feature">ğŸ† Global Leaderboard</div>
                <div class="feature">ğŸŒ 8 Languages</div>
            </div>
            <button id="got-it-btn" data-i18n="start">Start Scanning</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <!-- TensorFlow & COCO-SSD -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3"></script>

    <script src="app.js"></script>
</body>

</html>